FROM public.ecr.aws/sam/build-nodejs20.x:latest

# 作業ディレクトリの設定
WORKDIR /var/task

# システムパッケージの更新
RUN yum update -y

# AWS SAM CLIのインストール（既にベースイメージに含まれているが、最新版を確保）
RUN pip3 install --upgrade aws-sam-cli

# Node.jsの依存関係をコピーしてインストール
COPY package*.json ./
RUN npm ci

# アプリケーションコードをコピー
COPY . .

# ポート3000を公開
EXPOSE 3000

# SAM Localを起動
CMD ["sam", "local", "start-api", "--host", "0.0.0.0", "--port", "3000"] 